<!DOCTYPE html>
<!--[if (IE 7)&!(IEMobile)]><html class="no-js ie ie7" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js ie ie8" lang="en"><![endif]-->
<!--[if (IE 9)&!(IEMobile)]><html class="no-js ie ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<html>
<head>
<meta charset="utf-8">
<title>Inline Functions</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<link rel="Shortcut Icon" href="/assets/images/favicon.ico" type="image/x-icon"/>
<link rel="apple-touch-icon" href="/assets/images/apple-touch-icon.png" />
<link rel="apple-touch-icon" sizes="72x72" href="/assets/images/apple-touch-icon-72x72.png" />
<link rel="apple-touch-icon" sizes="114x114" href="/assets/images/apple-touch-icon-114x114.png" />
<link rel="apple-touch-icon" sizes="144x144" href="/assets/images/apple-touch-icon-144x144.png" />
<link rel="stylesheet" href="/css/styles.css">
<!-- begin Convert Experiments code--><script type="text/javascript">var _conv_host = (("https:" == document.location.protocol) ? "https://d9jmv9u00p0mv.cloudfront.net" : "http://cdn-1.convertexperiments.com");document.write(decodeURIComponent("%3Cscript src='" + _conv_host + "/js/10013947-10013329.js' type='text/javascript'%3E%3C/script%3E"));</script><!-- end Convert Experiments code -->
<script src="/js/vendor/requirejs/require.js"></script>
<script src="/js/config/bootstrap.js"></script>
</head>
<body>
<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5P98');</script>
<!-- End Google Tag Manager -->
<!-- CrazyEgg -->
<script type="text/javascript">
setTimeout(function(){var a=document.createElement("script");
var b=document.getElementsByTagName("script")[0];
a.src=document.location.protocol+"//dnn506yrbagrg.cloudfront.net/pages/scripts/0013/6939.js?"+Math.floor(new Date().getTime()/3600000);
a.async=true;a.type="text/javascript";b.parentNode.insertBefore(a,b)}, 1);
</script>
<!-- End CrazyEgg -->


<div class="global-layout">

    <header class="global-header">

    <div class="global-header-panel">
        <div class="g-layout">
            <a class="global-header-logo" href="/">Kotlin</a>

            
                
            

            <nav role="navigation" class="global-nav">
    

    
        
        
        
        

        

        
            
        

        

        <a href="/docs/reference/"
           class="nav-item is_active"
        >
            Learn
        </a>
    
        
        
        
        

        

        

        

        <a href="/contribute.html"
           class="nav-item "
        >
            Contribute
        </a>
    
        
        
        
        

        

        

        
            
        

        <a href="http://try.kotlinlang.org"
           class="nav-item "
        >
            Try Online
        </a>
    
        
        
        
        

        
            

    
        <div class="extra-nav download-button">
            <a href="/#get-kotlin" class="get-kotlin-button">
                Get Kotlin
                <span class="version">(0.12.613)</span>
            </a>
        </div>
    
</nav>

        </div>
    </div>
    
    <div class="g-layout">
        
    </div>
</header>

    <div class="g-layout global-content">
        <div class="g-grid">

    <div class="g-12">
        
    

    <nav role="navigation" class="docs-nav">
        
            
            

            <div class="nav-item-wrap">
            
                    <a href="/docs/reference/" class="nav-item is_active">
                        <span class="nav-item-text">
                            Reference
                        </span>
                    </a>
            
            </div>
        
            
            

            <div class="nav-item-wrap">
            
                <a href="/docs/tutorials/" class="nav-item">
                    <span class="nav-item-text">
                        Tutorials
                    </span>
                </a>

            
            </div>
        
            
            

            <div class="nav-item-wrap">
            
                <a href="/docs/videos.html" class="nav-item">
                    <span class="nav-item-text">
                        Videos
                    </span>
                </a>

            
            </div>
        
            
            

            <div class="nav-item-wrap">
            
                <a href="/docs/events.html" class="nav-item">
                    <span class="nav-item-text">
                        Events
                    </span>
                </a>

            
            </div>
        
            
            

            <div class="nav-item-wrap">
            
                <a href="/docs/resources.html" class="nav-item">
                    <span class="nav-item-text">
                        More resources
                    </span>
                </a>

            
            </div>
        
    </nav>


    </div>

    <aside class="g-3">
        <div id="reference-nav">
            



    

        
            
        

        
    

        
            
        

        
    

        
            
        

        
    

    

        
            
        

        
    

        
            
        

        
    

        
            
        

        
    

        
            
        

        
    

    

        
            
        

        
    

        
            
        

        
    

        
            
        

        
    

        
            
        

        
    

        
            
        

        
    

        
            
        

        
    

        
            
        

        
    

        
            
        

        
    

        
            
        

        
    

        
            
        

        
    

        
            
        

        
    

        
            
        

        
    

    

        
            
        

        
    

        
            
        

        
    

        
            
        

        
            
        
    

    

        
            
        

        
    

        
            
        

        
    

        
            
        

        
    

        
            
        

        
    

        
            
        

        
    

        
            
        

        
    

        
            
        

        
    

        
            
        

        
    

        
            
        

        
    

        
            
        

        
    

        
            
        

        
    

        
            
        

        
    

    

        
            
        

        
    

        
            
        

        
    

    

        
            
        

        
    

    

        
            
        

        
    

        
            
        

        
    

        
            
        

        
    

        
            
        

        
    

        
            
        

        
    

    

        
            
        

        
    

        
            
        

        
    

        
            
        

        
    



<nav role="navigation" class="side-tree-nav">

    

    <div class="tree-item tree-branch js-item js-branch _closed"
         data-id="Getting Started">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title">
            <div class="marker"></div>
            <div class="text">Getting Started</div>
        </div>

        
            
            
                
                
            

            
            

            <div class="tree-item tree-leaf js-item js-leaf">
            
                <a href="/docs/reference/basic-syntax.html"
                   class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
                   ><span class="marker"></span><span class="text">Basic Syntax</span></a>
            
            </div>
        
            
            
                
                
            

            
            

            <div class="tree-item tree-leaf js-item js-leaf">
            
                <a href="/docs/reference/idioms.html"
                   class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
                   ><span class="marker"></span><span class="text">Idioms</span></a>
            
            </div>
        
            
            
                
                
            

            
            

            <div class="tree-item tree-leaf js-item js-leaf">
            
                <a href="/docs/reference/coding-conventions.html"
                   class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
                   ><span class="marker"></span><span class="text">Coding Conventions</span></a>
            
            </div>
        

    </div>

    

    

    <div class="tree-item tree-branch js-item js-branch _closed"
         data-id="Basics">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title">
            <div class="marker"></div>
            <div class="text">Basics</div>
        </div>

        
            
            
                
                
            

            
            

            <div class="tree-item tree-leaf js-item js-leaf">
            
                <a href="/docs/reference/basic-types.html"
                   class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
                   ><span class="marker"></span><span class="text">Basic Types</span></a>
            
            </div>
        
            
            
                
                
            

            
            

            <div class="tree-item tree-leaf js-item js-leaf">
            
                <a href="/docs/reference/packages.html"
                   class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
                   ><span class="marker"></span><span class="text">Packages</span></a>
            
            </div>
        
            
            
                
                
            

            
            

            <div class="tree-item tree-leaf js-item js-leaf">
            
                <a href="/docs/reference/control-flow.html"
                   class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
                   ><span class="marker"></span><span class="text">Control Flow</span></a>
            
            </div>
        
            
            
                
                
            

            
            

            <div class="tree-item tree-leaf js-item js-leaf">
            
                <a href="/docs/reference/returns.html"
                   class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
                   ><span class="marker"></span><span class="text">Returns and Jumps</span></a>
            
            </div>
        

    </div>

    

    

    <div class="tree-item tree-branch js-item js-branch _closed"
         data-id="Classes and Objects">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title">
            <div class="marker"></div>
            <div class="text">Classes and Objects</div>
        </div>

        
            
            
                
                
            

            
            

            <div class="tree-item tree-leaf js-item js-leaf">
            
                <a href="/docs/reference/classes.html"
                   class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
                   ><span class="marker"></span><span class="text">Classes and Inheritance</span></a>
            
            </div>
        
            
            
                
                
            

            
            

            <div class="tree-item tree-leaf js-item js-leaf">
            
                <a href="/docs/reference/properties.html"
                   class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
                   ><span class="marker"></span><span class="text">Properties and Fields</span></a>
            
            </div>
        
            
            
                
                
            

            
            

            <div class="tree-item tree-leaf js-item js-leaf">
            
                <a href="/docs/reference/interfaces.html"
                   class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
                   ><span class="marker"></span><span class="text">Interfaces</span></a>
            
            </div>
        
            
            
                
                
            

            
            

            <div class="tree-item tree-leaf js-item js-leaf">
            
                <a href="/docs/reference/visibility-modifiers.html"
                   class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
                   ><span class="marker"></span><span class="text">Visibility Modifiers</span></a>
            
            </div>
        
            
            
                
                
            

            
            

            <div class="tree-item tree-leaf js-item js-leaf">
            
                <a href="/docs/reference/extensions.html"
                   class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
                   ><span class="marker"></span><span class="text">Extensions</span></a>
            
            </div>
        
            
            
                
                
            

            
            

            <div class="tree-item tree-leaf js-item js-leaf">
            
                <a href="/docs/reference/data-classes.html"
                   class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
                   ><span class="marker"></span><span class="text">Data Classes</span></a>
            
            </div>
        
            
            
                
                
            

            
            

            <div class="tree-item tree-leaf js-item js-leaf">
            
                <a href="/docs/reference/generics.html"
                   class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
                   ><span class="marker"></span><span class="text">Generics</span></a>
            
            </div>
        
            
            
                
                
            

            
            

            <div class="tree-item tree-leaf js-item js-leaf">
            
                <a href="/docs/reference/nested-classes.html"
                   class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
                   ><span class="marker"></span><span class="text">Nested Classes</span></a>
            
            </div>
        
            
            
                
                
            

            
            

            <div class="tree-item tree-leaf js-item js-leaf">
            
                <a href="/docs/reference/enum-classes.html"
                   class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
                   ><span class="marker"></span><span class="text">Enum Classes</span></a>
            
            </div>
        
            
            
                
                
            

            
            

            <div class="tree-item tree-leaf js-item js-leaf">
            
                <a href="/docs/reference/object-declarations.html"
                   class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
                   ><span class="marker"></span><span class="text">Objects</span></a>
            
            </div>
        
            
            
                
                
            

            
            

            <div class="tree-item tree-leaf js-item js-leaf">
            
                <a href="/docs/reference/delegation.html"
                   class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
                   ><span class="marker"></span><span class="text">Delegation</span></a>
            
            </div>
        
            
            
                
                
            

            
            

            <div class="tree-item tree-leaf js-item js-leaf">
            
                <a href="/docs/reference/delegated-properties.html"
                   class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
                   ><span class="marker"></span><span class="text">Delegated Properties</span></a>
            
            </div>
        

    </div>

    

    

    <div class="tree-item tree-branch js-item js-branch _opened"
         data-id="Functions and Lambdas">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title">
            <div class="marker"></div>
            <div class="text">Functions and Lambdas</div>
        </div>

        
            
            
                
                
            

            
            

            <div class="tree-item tree-leaf js-item js-leaf">
            
                <a href="/docs/reference/functions.html"
                   class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
                   ><span class="marker"></span><span class="text">Functions</span></a>
            
            </div>
        
            
            
                
                
            

            
            

            <div class="tree-item tree-leaf js-item js-leaf">
            
                <a href="/docs/reference/lambdas.html"
                   class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
                   ><span class="marker"></span><span class="text">Lambdas</span></a>
            
            </div>
        
            
            
                
                
            

            
            

            <div class="tree-item tree-leaf js-item js-leaf">
            
                <div class="tree-item-title tree-leaf-title js-item-title js-leaf-title is_active">
                    <div class="marker"></div>
                    <div class="text">Inline Functions</div>
                </div>
            
            </div>
        

    </div>

    

    

    <div class="tree-item tree-branch js-item js-branch _closed"
         data-id="Other">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title">
            <div class="marker"></div>
            <div class="text">Other</div>
        </div>

        
            
            
                
                
            

            
            

            <div class="tree-item tree-leaf js-item js-leaf">
            
                <a href="/docs/reference/multi-declarations.html"
                   class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
                   ><span class="marker"></span><span class="text">Multi-Declarations</span></a>
            
            </div>
        
            
            
                
                
            

            
            

            <div class="tree-item tree-leaf js-item js-leaf">
            
                <a href="/docs/reference/ranges.html"
                   class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
                   ><span class="marker"></span><span class="text">Ranges</span></a>
            
            </div>
        
            
            
                
                
            

            
            

            <div class="tree-item tree-leaf js-item js-leaf">
            
                <a href="/docs/reference/typecasts.html"
                   class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
                   ><span class="marker"></span><span class="text">Type Checks and Casts</span></a>
            
            </div>
        
            
            
                
                
            

            
            

            <div class="tree-item tree-leaf js-item js-leaf">
            
                <a href="/docs/reference/this-expressions.html"
                   class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
                   ><span class="marker"></span><span class="text">This expressions</span></a>
            
            </div>
        
            
            
                
                
            

            
            

            <div class="tree-item tree-leaf js-item js-leaf">
            
                <a href="/docs/reference/equality.html"
                   class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
                   ><span class="marker"></span><span class="text">Equality</span></a>
            
            </div>
        
            
            
                
                
            

            
            

            <div class="tree-item tree-leaf js-item js-leaf">
            
                <a href="/docs/reference/operator-overloading.html"
                   class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
                   ><span class="marker"></span><span class="text">Operator overloading</span></a>
            
            </div>
        
            
            
                
                
            

            
            

            <div class="tree-item tree-leaf js-item js-leaf">
            
                <a href="/docs/reference/null-safety.html"
                   class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
                   ><span class="marker"></span><span class="text">Null Safety</span></a>
            
            </div>
        
            
            
                
                
            

            
            

            <div class="tree-item tree-leaf js-item js-leaf">
            
                <a href="/docs/reference/exceptions.html"
                   class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
                   ><span class="marker"></span><span class="text">Exceptions</span></a>
            
            </div>
        
            
            
                
                
            

            
            

            <div class="tree-item tree-leaf js-item js-leaf">
            
                <a href="/docs/reference/annotations.html"
                   class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
                   ><span class="marker"></span><span class="text">Annotations</span></a>
            
            </div>
        
            
            
                
                
            

            
            

            <div class="tree-item tree-leaf js-item js-leaf">
            
                <a href="/docs/reference/reflection.html"
                   class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
                   ><span class="marker"></span><span class="text">Reflection</span></a>
            
            </div>
        
            
            
                
                
            

            
            

            <div class="tree-item tree-leaf js-item js-leaf">
            
                <a href="/docs/reference/type-safe-builders.html"
                   class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
                   ><span class="marker"></span><span class="text">Type-Safe Builders</span></a>
            
            </div>
        
            
            
                
                
            

            
            

            <div class="tree-item tree-leaf js-item js-leaf">
            
                <a href="/docs/reference/dynamic-type.html"
                   class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
                   ><span class="marker"></span><span class="text">Dynamic Type</span></a>
            
            </div>
        

    </div>

    

    

    <div class="tree-item tree-branch js-item js-branch _closed"
         data-id="Reference">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title">
            <div class="marker"></div>
            <div class="text">Reference</div>
        </div>

        
            
            
                
                
            

            
            

            <div class="tree-item tree-leaf js-item js-leaf">
            
                <a href="/api/latest/jvm/stdlib/index.html"
                   class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
                   ><span class="marker"></span><span class="text">API Reference</span></a>
            
            </div>
        
            
            
                
                
            

            
            

            <div class="tree-item tree-leaf js-item js-leaf">
            
                <a href="/docs/reference/grammar.html"
                   class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
                   ><span class="marker"></span><span class="text">Grammar</span></a>
            
            </div>
        

    </div>

    

    

    <div class="tree-item tree-branch js-item js-branch _closed"
         data-id="Interop">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title">
            <div class="marker"></div>
            <div class="text">Interop</div>
        </div>

        
            
            
                
                
            

            
            

            <div class="tree-item tree-leaf js-item js-leaf">
            
                <a href="/docs/reference/java-interop.html"
                   class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
                   ><span class="marker"></span><span class="text">Java Interop</span></a>
            
            </div>
        

    </div>

    

    

    <div class="tree-item tree-branch js-item js-branch _closed"
         data-id="Tools">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title">
            <div class="marker"></div>
            <div class="text">Tools</div>
        </div>

        
            
            
                
                
            

            
            

            <div class="tree-item tree-leaf js-item js-leaf">
            
                <a href="/docs/reference/kotlin-doc.html"
                   class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
                   ><span class="marker"></span><span class="text">Documenting Kotlin Code</span></a>
            
            </div>
        
            
            
                
                
            

            
            

            <div class="tree-item tree-leaf js-item js-leaf">
            
                <a href="/docs/reference/using-maven.html"
                   class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
                   ><span class="marker"></span><span class="text">Using Maven</span></a>
            
            </div>
        
            
            
                
                
            

            
            

            <div class="tree-item tree-leaf js-item js-leaf">
            
                <a href="/docs/reference/using-ant.html"
                   class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
                   ><span class="marker"></span><span class="text">Using Ant</span></a>
            
            </div>
        
            
            
                
                
            

            
            

            <div class="tree-item tree-leaf js-item js-leaf">
            
                <a href="/docs/reference/using-griffon.html"
                   class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
                   ><span class="marker"></span><span class="text">Using Griffon</span></a>
            
            </div>
        
            
            
                
                
            

            
            

            <div class="tree-item tree-leaf js-item js-leaf">
            
                <a href="/docs/reference/using-gradle.html"
                   class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
                   ><span class="marker"></span><span class="text">Using Gradle</span></a>
            
            </div>
        

    </div>

    

    

    <div class="tree-item tree-branch js-item js-branch _closed"
         data-id="FAQ">

        <div class="tree-item-title tree-branch-title js-item-title js-branch-title">
            <div class="marker"></div>
            <div class="text">FAQ</div>
        </div>

        
            
            
                
                
            

            
            

            <div class="tree-item tree-leaf js-item js-leaf">
            
                <a href="/docs/reference/faq.html"
                   class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
                   ><span class="marker"></span><span class="text">FAQ</span></a>
            
            </div>
        
            
            
                
                
            

            
            

            <div class="tree-item tree-leaf js-item js-leaf">
            
                <a href="/docs/reference/comparison-to-java.html"
                   class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
                   ><span class="marker"></span><span class="text">Comparison to Java</span></a>
            
            </div>
        
            
            
                
                
            

            
            

            <div class="tree-item tree-leaf js-item js-leaf">
            
                <a href="/docs/reference/comparison-to-scala.html"
                   class="tree-item-title tree-leaf-title js-item-title js-leaf-title "
                   ><span class="marker"></span><span class="text">Comparison to Scala</span></a>
            
            </div>
        

    </div>

    

</nav>

            <a href="/docs/kotlin-docs.pdf" class="reference-pdf-link">
                <span class="icon"></span>
                <span class="text">Full Kotlin Reference</span>
            </a>
        </div>
    </aside>

    <article role="main" class="page-content g-9">
        


<a href="https://github.com/JetBrains/kotlin-web-site/edit/master/docs/reference/inline-functions.md"
   class="page-link-to-github"
   target="_blank"
   title="Edit this page on GitHub">
        <i class="github-icon"></i>
        <span class="text">Edit Page</span>
</a>

        <h1 id="inline-functions">Inline Functions<a href="#inline-functions" class="anchor"></a></h1>

<p>Using <a href="lambdas.html">higher-order functions</a> imposes certain runtime penalties: each function is an object, and it captures a closure,
i.e. those variables that are accessed in the body of the function.
Memory allocations (both for function objects and classes) and virtual calls introduce runtime overhead.</p>

<p>But it appears that in many cases this kind of overhead can be eliminated by inlining the function literals.
The functions shown above are good examples of this situation. I.e., the <code>lock()</code> function could be easily inlined at call-sites.
Consider the following case:</p>

<pre><code class="code-block _highlighted lang_kotlin"><span class="n">lock</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="p">{</span><span class="n">foo</span><span class="p">()}</span></code></pre>

<p>Instead of creating a function object for the parameter and generating a call, the compiler could emit the following code</p>

<pre><code class="code-block _highlighted lang_kotlin"><span class="n">lock</span><span class="p">.</span><span class="n">lock</span><span class="p">()</span>
<span class="k">try</span> <span class="p">{</span>
  <span class="n">foo</span><span class="p">()</span>
<span class="p">}</span>
<span class="k">finally</span> <span class="p">{</span>
  <span class="n">lock</span><span class="p">.</span><span class="n">unlock</span><span class="p">()</span>
<span class="p">}</span></code></pre>

<p>Isn’t it what we wanted from the very beginning?</p>

<p>To make the compiler do this, we need to annotate the <code>lock()</code> function with the <code>inline</code> annotation:</p>

<pre><code class="code-block _highlighted lang_kotlin"><span class="n">inline</span> <span class="k">fun</span> <span class="nf">lock</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="n">lock</span><span class="p">:</span> <span class="n">Lock</span><span class="p">,</span> <span class="n">body</span><span class="p">:</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="n">T</span><span class="p">):</span> <span class="n">T</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span></code></pre>

<p>The <code>inline</code> annotation affects both the function itself and the lambdas passed to it: all of those will be inlined
into the call site.</p>

<p>Inlining may cause the generated code to grow, but if we do it in a reasonable way (do not inline big functions)
it will pay off in performance, especially at “megamorphic” call-sites inside loops.</p>

<h2 id="noinline">@noinline<a href="#noinline" class="anchor"></a></h2>

<p>In case you want only some of the lambdas passed to an inline function to be inlined, you can mark some of your function
parameters with <code>@noinline</code> annotation:</p>

<pre><code class="code-block _highlighted lang_kotlin"><span class="n">inline</span> <span class="k">fun</span> <span class="nf">foo</span><span class="p">(</span><span class="n">inlined</span><span class="p">:</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="n">Unit</span><span class="p">,</span> <span class="n">@noinline</span> <span class="n">notInlined</span><span class="p">:</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="n">Unit</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span></code></pre>

<p>Inlinable lambdas can only be called inside the inline functions or passed as inlinable arguments,
but <code>@noinline</code> ones can be manipulated in any way we like: stored in fields, passed around etc.</p>

<p>Note that if an inline function has no inlinable function parameters and no
<a href="#reified-type-parameters">reified type parameters</a>, the compiler will issue a warning, since inlining such functions is
 very unlikely to be beneficial (you can suppress the warning if you are sure the inlining is needed).</p>

<h2 id="non-local-returns">Non-local returns<a href="#non-local-returns" class="anchor"></a></h2>

<p>In Kotlin, we can only use a normal, unqualified <code>return</code> to exit a named function or a function expression.
This means that to exit a lambda, we have to use a <a href="returns.html#return-at-labels">label</a>, and a bare <code>return</code> is forbidden
inside a lambda, because a lambda can not make the enclosing function return:</p>

<pre><code class="code-block _highlighted lang_kotlin"><span class="k">fun</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">ordinaryFunction</span> <span class="p">{</span>
     <span class="k">return</span> <span class="c1">// ERROR: can not make `foo` return here</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre>

<p>But if the function the lambda is passed to is inlined, the return can be inlined as well, so it is allowed:</p>

<pre><code class="code-block _highlighted lang_kotlin"><span class="k">fun</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">inlineFunction</span> <span class="p">{</span>
    <span class="k">return</span> <span class="c1">// OK: the lambda is inlined</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre>

<p>Such returns (located in a lambda, but exiting the enclosing function) are called <em>non-local</em> returns. We are used to
this sort of constructs in loops, which inline functions often enclose:</p>

<pre><code class="code-block _highlighted lang_kotlin"><span class="k">fun</span> <span class="nf">hasZeros</span><span class="p">(</span><span class="n">ints</span><span class="p">:</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">&gt;):</span> <span class="n">Boolean</span> <span class="p">{</span>
  <span class="n">ints</span><span class="p">.</span><span class="n">forEach</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">it</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span> <span class="k">return</span> <span class="k">true</span> <span class="c1">// returns from hasZeros</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="k">false</span>
<span class="p">}</span></code></pre>

<p>Note that some inline functions may call the lambdas passed to them as parameters not directly from the function body,
but from another execution context, such as a local object or a nested function. In such cases, non-local control flow
is also not allowed in the lambdas. To indicate that, the lambda parameter needs to be annotated with
the <code>InlineOptions.ONLY_LOCAL_RETURN</code> annotation:</p>

<pre><code class="code-block _highlighted lang_kotlin"><span class="n">inline</span> <span class="k">fun</span> <span class="nf">f</span><span class="p">(</span><span class="n">inlineOptions</span><span class="p">(</span><span class="n">InlineOption</span><span class="p">.</span><span class="n">ONLY_LOCAL_RETURN</span><span class="p">)</span> <span class="n">body</span><span class="p">:</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="n">Unit</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">val</span> <span class="py">f</span> <span class="p">=</span> <span class="k">object</span><span class="p">:</span> <span class="n">Runnable</span> <span class="p">{</span>
        <span class="k">override</span> <span class="k">fun</span> <span class="nf">run</span><span class="p">()</span> <span class="p">=</span> <span class="n">body</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="c1">// ...</span>
<span class="p">}</span></code></pre>

<blockquote>
  <p><code>break</code> and <code>continue</code> are not yet available in inlined lambdas, but we are planning to support them too</p>
</blockquote>

<h2 id="reified-type-parameters">Reified type parameters<a href="#reified-type-parameters" class="anchor"></a></h2>

<p>Sometimes we need to access a type passed to us as a parameter:</p>

<pre><code class="code-block _highlighted lang_kotlin"><span class="k">fun</span> <span class="err">&lt;</span><span class="nf">T</span><span class="p">&gt;</span> <span class="n">TreeNode</span><span class="p">.</span><span class="n">findParentOfType</span><span class="p">(</span><span class="n">clazz</span><span class="p">:</span> <span class="n">Class</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;):</span> <span class="n">T</span><span class="p">?</span> <span class="p">{</span>
    <span class="k">var</span> <span class="py">p</span> <span class="p">=</span> <span class="n">parent</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">p</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="n">clazz</span><span class="p">.</span><span class="n">isInstance</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">p</span> <span class="p">=</span> <span class="n">p</span><span class="o">?.</span><span class="n">parent</span>
    <span class="p">}</span>
    <span class="n">@suppress</span><span class="p">(</span><span class="s">&quot;UNCHECKED_CAST&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">p</span> <span class="k">as</span> <span class="n">T</span>
<span class="p">}</span></code></pre>

<p>Here, we walk up a tree and use reflection to check if a node has a certain type.
It’s all fine, but the call site is not very pretty:</p>

<pre><code class="code-block _highlighted lang_kotlin"><span class="n">myTree</span><span class="p">.</span><span class="n">findParentOfType</span><span class="p">(</span><span class="n">javaClass</span><span class="p">&lt;</span><span class="n">MyTreeNodeType</span><span class="p">&gt;())</span></code></pre>

<p>What we actually want is simply pass a type to this function, i.e. call is like this:</p>

<pre><code class="code-block _highlighted lang_kotlin"><span class="n">myTree</span><span class="p">.</span><span class="n">findParentOfType</span><span class="p">&lt;</span><span class="n">MyTreeNodeType</span><span class="p">&gt;()</span></code></pre>

<p>To enable this, inline functions support <em>reified type parameters</em>, so we can write something like this:</p>

<pre><code class="code-block _highlighted lang_kotlin"><span class="n">inline</span> <span class="k">fun</span> <span class="err">&lt;</span><span class="nf">reified</span> <span class="n">T</span><span class="p">&gt;</span> <span class="n">TreeNode</span><span class="p">.</span><span class="n">findParentOfType</span><span class="p">():</span> <span class="n">T</span><span class="p">?</span> <span class="p">{</span>
    <span class="k">var</span> <span class="py">p</span> <span class="p">=</span> <span class="n">parent</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">p</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="n">p</span> <span class="p">!</span><span class="k">is</span> <span class="n">T</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">p</span> <span class="p">=</span> <span class="n">p</span><span class="o">?.</span><span class="n">parent</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">p</span> <span class="k">as</span> <span class="n">T</span>
<span class="p">}</span></code></pre>

<p>We qualified the type parameter with the reified modifier, now it’s accessible inside the function,
almost as if it were a normal class. Since the function is inlined, no reflection is needed, normal operators like <code>!is</code>
and <code>as</code> are working now. Also, we can call it as mentioned above: <code>myTree.findParentOfType&lt;MyTreeNodeType&gt;()</code>.</p>

<p>Though reflection may not be needed in many cases, we can still use it with a reified type parameter: <code>javaClass()</code> gives us access to it:</p>

<pre><code class="code-block _highlighted lang_kotlin"><span class="n">inline</span> <span class="k">fun</span> <span class="nf">methodsOf</span><span class="p">&lt;</span><span class="k">reified</span> <span class="n">T</span><span class="p">&gt;()</span> <span class="p">=</span> <span class="n">javaClass</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;().</span><span class="n">getMethods</span><span class="p">()</span>

<span class="k">fun</span> <span class="nf">main</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="n">Array</span><span class="p">&lt;</span><span class="n">String</span><span class="p">&gt;)</span> <span class="p">{</span>
  <span class="n">println</span><span class="p">(</span><span class="n">methodsOf</span><span class="p">&lt;</span><span class="n">String</span><span class="p">&gt;().</span><span class="n">joinToString</span><span class="p">(</span><span class="s">&quot;\n&quot;</span><span class="p">))</span>
<span class="p">}</span></code></pre>

<p>Normal functions (not marked as inline) can not have reified parameters.
A type that does not have a run-time representation (e.g. a non-reified type parameter or a fictitious type like <code>Nothing</code>)
can not be used as an argument for a reified type parameter.</p>

<p>For a low-level description, see the <a href="https://github.com/JetBrains/kotlin/blob/master/spec-docs/reified-type-parameters.md">spec document</a>.</p>

    </article>
</div>

<script>
require(['page/reference'], function(page) {
    page();
});
</script>
    </div>

</div>

<footer role="contentinfo" class="global-footer">

    <div class="global-footer-terms">
        <div class="g-layout">

            <div class="terms-copyright">
                &copy; 2000&ndash;2015 JetBrains. All rights reserved
            </div>

            <div class="terms-sponsor">
                Sponsored and developed by <a href="http://jetbrains.com" class="sponsor sponsor_jetbrains" target="_blank">JetBrains</a>
            </div>
        </div>
    </div>

</footer>
</body>
</html>